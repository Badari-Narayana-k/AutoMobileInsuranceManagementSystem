<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <meta charset="UTF-8">
    <title>Create Policy</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <style>
        /* Define consistent color variables for easy management */
        :root {
            --primary-blue: #0d6efd; /* Bootstrap primary blue */
            --dark-navy: rgba(0, 0, 139, 0.8); /* Used for navbar */
            --dark-navy-scrolled: rgba(0, 0, 100, 0.9);
            --light-bg: #f8f9fa; /* Light background for sections */
            --off-white: #ffffff; /* Card backgrounds, etc. */
            --text-dark: #343a40; /* General dark text */
            --text-muted: #6c757d; /* Lighter text */
        }

        body {
            font-family: 'Inter', 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(to bottom right, #eaf2f8, #f8f9fa); /* Softer gradient */
            color: var(--text-dark);
            min-height: 100vh;
            display: flex;
            flex-direction: column; /* For sticky footer or overall layout */
        }

        /* --- Navbar Styles (Consistent with other pages) --- */
        .navbar {
            background: var(--dark-navy) !important; /* Force consistency */
            border: none !important;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15) !important;
            transition: all 0.3s ease;
            border-radius: 0.75rem; /* Rounded navbar edges */
            backdrop-filter: blur(15px); /* Glassy effect */
            -webkit-backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .navbar-brand, .navbar-nav .nav-link {
            color: rgba(255, 255, 255, 0.95) !important;
            font-weight: 500;
            transition: color 0.3s ease, transform 0.2s ease;
            padding-top: 0.75rem;
            padding-bottom: 0.75rem;
        }
        .navbar-nav .nav-link:hover {
            color: #ffffff !important;
            transform: translateY(-2px);
        }
        .navbar.scrolled {
            background: var(--dark-navy-scrolled) !important;
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.2) !important;
        }

        /* --- Form Section Styling --- */
        .form-section {
            background: rgba(255, 255, 255, 0.85); /* Glass-card like background */
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.1);
            border-radius: 1rem;
            padding: 2.5rem;
            border: 1px solid rgba(255, 255, 255, 0.3);
            transition: all 0.3s ease;
        }
        .form-section:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 40px rgba(31, 38, 135, 0.15);
        }

        .form-section h2 {
            color: var(--primary-blue);
            font-weight: 700;
            margin-bottom: 0.75rem;
        }
        .form-section p.lead-text {
            color: var(--text-muted);
            margin-bottom: 2.5rem;
            font-size: 1.05rem;
        }

        .form-label {
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 0.5rem;
        }

        .form-control, .form-select {
            border-radius: 0.75rem; /* More rounded inputs */
            border: 1px solid #ced4da;
            padding: 0.75rem 1rem;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.05);
            transition: border-color 0.2s ease, box-shadow 0.2s ease, color 0.2s ease; /* Add color transition */
        }

        .form-control:focus, .form-select:focus {
            border-color: var(--primary-blue);
            box-shadow: 0 0 0 0.25rem rgba(var(--bs-primary-rgb), 0.25);
            outline: none;
        }

        .btn-primary {
            background-color: var(--primary-blue);
            border-color: var(--primary-blue);
            font-weight: 600;
            border-radius: 0.75rem;
            padding: 0.75rem 1.75rem;
            transition: all 0.3s ease;
        }
        .btn-primary:hover {
            background-color: #0a58ca;
            border-color: #0a58ca;
            transform: translateY(-2px);
        }

        .gold-text-option { /* For dropdown option text */
            color: #d4af37; /* Gold color for option */
            font-weight: bold;
        }
        .gold-input-text { /* For input field text color */
            color: #d4af37 !important; /* Force gold color for input text */
            font-weight: bold;
        }
    </style>
</head>
<body>
<nav class="navbar navbar-expand-lg mx-auto mt-3 px-4 py-2"
    style="width: 95%; max-width: 1400px; position: sticky; top: 20px; z-index: 1030;">
<div class="container-fluid">
<a class="navbar-brand fw-bold text-white" href="/agent/home"><i class="bi bi-shield-lock-fill me-2"></i>InsuranceApp</a>
<button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
                aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
<span class="navbar-toggler-icon" style="filter: invert(1);"></span>
</button>
<div class="collapse navbar-collapse" id="navbarNav">
<ul class="navbar-nav ms-auto">
<li class="nav-item"><a class="nav-link active" aria-current="page" th:href="@{/create-policy}" ><i class="bi bi-journal-check me-1"></i>Policy</a></li>
<li class="nav-item"><a class="nav-link text-white" th:href="@{/agent/claim-requests}"><i class="bi bi-file-earmark-text-fill me-1"></i>Claims</a></li>
<li class="nav-item"><a class="nav-link text-white" th:href="@{/profile}"><i class="bi bi-person-circle me-1"></i>Profile</a></li>
                <li class="nav-item"><a class="nav-link" th:href="@{/agent/support/tickets}"><i class="bi bi-ticket-fill me-1"></i>User Tickets</a></li>

<li class="nav-item"><a class="nav-link text-white" th:href="@{/logout}"><i class="bi bi-box-arrow-right me-1"></i>Logout</a></li>
</ul>
</div>
</div>
</nav>

<div class="container my-5 flex-grow-1 d-flex align-items-center">
    <div class="row justify-content-center w-100">
        <div class="col-lg-8 col-md-10">
            <div class="form-section">
                <h2 class="text-center">Create a New Vehicle Policy</h2>
                <p class="text-center lead-text">Fill in the details below to add a new insurance policy to the system.</p>

                <form th:action="@{/create-policy}" method="post" th:object="${policy}" class="mt-4">
                    <div class="row g-3">
                        <div class="col-md-6">
                            <label for="policyName" class="form-label">Policy Name</label>
                            <input type="text" id="policyName" th:field="*{policyName}" class="form-control" 
                                   data-base-name="" required />
                        </div>
                        <div class="col-md-6">
                            <label for="vehicleType" class="form-label">Vehicle Type</label>
                            <select id="vehicleType" th:field="*{vehicleType}" class="form-select" required>
                                <option value="">Select Vehicle Type</option>
                                <optgroup label="Road Vehicles">
                                    <option value="Bike">Bike</option>
                                    <option value="Car - Sedan">Car - Sedan</option>
                                    <option value="Car - SUV">Car - SUV</option>
                                    <option value="Car - Other">Car - Other Types</option>
                                    <option value="Auto">Auto</option>
                                    <option value="Trucks">Trucks</option>
                                    <option value="Heavy Loaders">Heavy Loaders</option>
                                    <option value="Nuke Trucks">Nuke Trucks</option>
                                </optgroup>
                                <optgroup label="Air Vehicles">
                                    <option value="Flights">Flights (Commercial)</option>
                                    <option value="Jets">Jets (Private)</option>
                                    <option value="Helicopters">Helicopters</option>
                                    <option value="Fighter Planes">Fighter Planes</option>
                                </optgroup>
                                <optgroup label="Other Vehicles">
                                    <option value="Trains">Trains</option>
                                    <option value="Tanks">Tanks</option>
                                </optgroup>
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label for="policyType" class="form-label">Policy Type</label>
                            <select id="policyType" th:field="*{policyType}" class="form-select" required>
                                <option value="">Select Policy Type</option>
                                <option value="Standard">Standard</option>
                                <option value="Premium" class="gold-text-option">Premium</option>
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label for="coverageRate" class="form-label">Coverage Rate (%)</label>
                            <input type="number" id="coverageRate" th:field="*{coverageRate}" class="form-control" readonly required />
                        </div>
                        <div class="col-12">
                            <label for="price" class="form-label">Price (â‚¹)</label>
                            <input type="number" id="price" th:field="*{price}" step="0.01" class="form-control" placeholder="e.g., 15000.00" required />
                        </div>
                        <div class="col-12">
                            <label for="description" class="form-label">Description</label>
                            <textarea id="description" th:field="*{description}" class="form-control" rows="4" placeholder="Provide a brief description of the policy coverage..."></textarea>
                        </div>
                    </div>
                    
                    <div class="d-grid mt-4">
                        <button type="submit" class="btn btn-primary btn-lg"><i class="bi bi-plus-circle-fill me-2"></i>Create Policy</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script th:inline="javascript">
    // Navbar scroll effect for consistency
    window.addEventListener('scroll', function() {
        const navbar = document.querySelector('.navbar');
        if (window.scrollY > 30) {
            navbar.classList.add('scrolled');
        } else {
            navbar.classList.remove('scrolled');
        }
    });

    document.addEventListener('DOMContentLoaded', function() {
        const policyTypeSelect = document.getElementById('policyType');
        const coverageRateInput = document.getElementById('coverageRate');
        const policyNameInput = document.getElementById('policyName');

        // Initialize data-base-name if policyName is pre-filled (e.g., on form error)
        // This handles cases where the page loads with existing policy data
        if (policyNameInput.value) {
            const currentName = policyNameInput.value;
            const suffixRegex = / - \(Standard\)| - \(Premium\)/;
            const baseNameMatch = currentName.match(/^(.+?)( - \(Standard\)| - \(Premium\))?$/);
            if (baseNameMatch && baseNameMatch[1]) {
                policyNameInput.dataset.baseName = baseNameMatch[1].trim();
            } else {
                policyNameInput.dataset.baseName = currentName.trim();
            }
        } else {
            policyNameInput.dataset.baseName = ''; // Ensure it's empty if no initial value
        }


        // Function to update coverage rate based on policy type
        function updateCoverageRate() {
            const selectedPolicyType = policyTypeSelect.value;
            if (selectedPolicyType === 'Standard') {
                coverageRateInput.value = 80;
            } else if (selectedPolicyType === 'Premium') {
                coverageRateInput.value = 100;
            } else {
                coverageRateInput.value = ''; // Clear if no policy type selected
            }
        }

        // Function to update policy name and its color
        function updatePolicyNameAndColor() {
            let baseName = policyNameInput.dataset.baseName || policyNameInput.value; // Use dataset, fallback to current value
            const selectedPolicyType = policyTypeSelect.value;

            // Clean existing suffix if present, ensuring we always start from the base name
            const suffixRegex = / - \(Standard\)| - \(Premium\)/;
            if (baseName.match(suffixRegex)) {
                baseName = baseName.replace(suffixRegex, '').trim();
            }
            policyNameInput.dataset.baseName = baseName; // Update base name in dataset

            let newPolicyName = baseName;
            policyNameInput.classList.remove('gold-input-text'); // Remove gold class initially

            if (selectedPolicyType === 'Standard') {
                newPolicyName += ' - (Standard)';
            } else if (selectedPolicyType === 'Premium') {
                newPolicyName += ' - (Premium)';
                policyNameInput.classList.add('gold-input-text'); // Add gold class for premium
            }

            policyNameInput.value = newPolicyName.trim();
        }

        // Event listener for Policy Name input change (to update base-name)
        policyNameInput.addEventListener('input', function() {
            // As the user types, update the base name, ensuring we don't include suffixes
            const currentVal = policyNameInput.value;
            const suffixRegex = / - \(Standard\)| - \(Premium\)/;
            if (!currentVal.match(suffixRegex)) { // Only update base name if suffix is NOT present
                policyNameInput.dataset.baseName = currentVal.trim();
            }
            // Re-call updatePolicyNameAndColor to ensure suffix is correctly applied after base name changes
            updatePolicyNameAndColor();
        });


        // Add event listener for when policy type changes
        policyTypeSelect.addEventListener('change', function() {
            updateCoverageRate();
            updatePolicyNameAndColor();
        });

        // Call functions once on load to set initial state (useful if form is pre-filled, e.g., on validation error)
        updateCoverageRate();
        updatePolicyNameAndColor();
    });
</script>
</body>
</html>